---
layout: post
title: Installation d&apos;un serveur Glassfish + Apache + PHP + MySQL sur Windows
originalName: installation-du-serveur-1.html
date: 2007-09-19
comments: false
categories : [archives]
tags: [informatique, java, linux]
---

<h2 class="western" lang="fr-FR">1.Jdk Java (jdk 6 update 2) [La base Java]</h2> <h3 class="western" lang="fr-FR">Installation</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Installer le jdk (lancer l’exécutable), laisser la configuration standard.  </p> <h3 class="western" lang="fr-FR">Configuration  </h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Définir la variable d’environnement <b>JAVA_HOME</b> qui pointe sur le répertoire d’installation du Jdk (généralement C:Program FilesJavajdk_6_2_0).  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redéfinir la variable d’environnement <b>PATH</b>, pour qu’elle intègre les exécutables Java. (Généralement dans C:Program FilesJavajdk_6_2_0bin).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour accéder aux variables d’environnement, aller dans les propriétés système (clic droit sur le poste de travail / propriétés), aller dans l’onglet Paramètres systèmes avancés, puis cliquer sur variables d’environnement.</p> <h2 class="western" lang="fr-FR">2.Apache 2.2  [le serveur web qui reçoit les requêtes des clients]</h2> <h3 class="western" lang="fr-FR">Installation</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Installer Apache 2.2 (si possible à la racine pour éviter des espaces dans les adresses) (lancer le msi)</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Suivre les indications pour la configuration, en spécifiant que le serveur écoute sur le <b>port 80</b> (port standard du web). Pensez à indiquer le nom du domain, du serveur  ainsi que l’adresse mail du webmaster.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Demander un démarrage en service pour que le serveur web soit démarré à chaque reboot.  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redéfinir la variable d’environnement <b>PATH</b>, pour qu’elle intègre les exécutables (Généralement dans C:apachebin).</p> <h3 class="western" lang="fr-FR">Configuration</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le répertoire de configuration est trouve dans <b>Apacheconf</b> et le principal fichier de configuration est <b>httpd.conf.</b></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le répertoire des documents web (site web et application légères) est <b>htdocs.</b></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Il faut bien lire ce fichier ainsi que les explications pour comprendre le paramétrage du serveur, mais aucune configuration n’est nécessaire pour le moment.</p> <h3 class="western" lang="fr-FR">Utile</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour démarrer le serveur (le service pour être exact), utilisez la commande suivante :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>NET START APACHE2</b></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour l’éteindre :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>NET STOP APACHE2</b></span></span></span></p> <h2 class="western" lang="fr-FR">3.PHP 5.2.3  [le serveur applicatif léger, pour PhpMyAdmin…]  </h2> <h3 class="western" lang="fr-FR">Installation  </h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Installer PHP5.2.3 (si possible à la racine pour éviter des espaces dans les adresses) (lancer le msi)</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Suivre les indications pour la configuration, sélectionnez le module pour <b>Apache 2.2.x</b> et demander l’installation de toutes les <b>extensions</b> ainsi que de tous les composants optionnels. Vous devez aussi indique le répertoire de configuration d’Apache, c'est-à-dire le dossier <b>conf</b> de votre installation du serveur Apache 2.2.0.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redéfinir la variable d’environnement <b>PATH</b>, pour qu’elle intègre les exécutables.</p> <h3 class="western" lang="fr-FR">Configuration</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le principal fichier de configuration est PHP/<b>php.ini</b></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> On peut créer un fichier à partir d’un fichier type fourni par PHP en le modifiant ensuite.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Quel que soit le fichier que vous utilisez, vous devez <b>redéfinir les chemins d’accès aux fichiers</b>. Recherchez la variable <i>extension_dir </i>et modifiez sa valeur pour qu’elle pointe sur le répertoire ext de votre installation de PHP. Modifiez aussi les variables <i>upload_tmp_dir</i> et <i>session.save_path</i> pour qu’elles pointent sur des dossiers <u>existants.</u></p>  <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour que les fichiers PHP soient interprétés avant d’être servi par le serveur web Apache, il faut qu’Apache connaisse ce type de fichier et sache avec quel logiciel le traiter.  </p>  <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour cela l’installation de PHP a rajouté les lignes suivantes dans le fichier de configuration d’Apache (httpd.conf) (en pensant à adapter le chemin d’accès). Vous n’avez donc plus qu’à vérifier que l’ajout a bien été effectué.</p>    <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB">#BEGIN PHP INSTALLER EDITS - REMOVE ONLY ON UNINSTALL<br />PHPIniDir "C:\php\"<br />LoadModule php5_module "C:\php\php5apache2_2.dll"<br />#END PHP INSTALLER EDITS - REMOVE ONLY ON UNINSTALL</span></span></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Vous devez ensuite ajouter la reconnaissance du type mime dans <b><i>mime.types</i></b> (contenu dans le dossier conf d’Apache) :</p>  <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;">application/x-httpd-php  php php3 php4 php5<br />application/x-httpd-php-source  phps</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour que les pages d’index en PHP soit prises en compte, il vous faut aussi modifier la liste des fichiers d’index d’Apache. Dans le fichier de configuration <b>httpd.conf</b>, <b>modifiez</b> les lignes suivantes (on en profite pour ajouter quelques autres pages qui nous servirons plus tard). Vous devez ajouter les éléments en gras, le reste ne doit pas être modifié.</p>   <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;">&lt;IfModule dir_module&gt;<br />DirectoryIndex index.html <span style="font-size:100%;"><span lang=""><b>index.shtml index.htm index.php index.php3 index.php4 index.jsp default.html</b></span></span><br />&lt;/IfModule&gt;</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Si certaines applications vous demandent d’ajouter des modules, vous devrez les ajouter en retirant le signe de commentaire (#) de la ligne de chargement du module, par exemple :</p> <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;">#LoadModule autoindex_module modules/mod_autoindex.so</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour tester que tout marche bien, créez, à la racine du serveur (<b>Apache/htdocs/</b>), un fichier <b>index.php </b>qui contient :</p>   <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;">&lt;?php<br />phpinfo();<br />?&gt;</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redémarrer le serveur Apache pour qu’il prenne en compte les modifications que vous venez d’effectuer, puis tenter de lire ce fichier en demandant la page suivante à votre navigateur internet (Firefox, Internet Explorer...) : <span style="color:#0000ff;"><u><a href="http://localhost/">http://localhost/</a></u></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Vous devriez normalement tomber sur une longue page dans les tons violets. Dans ce cas, vous savez que le fichier index.php a été considéré comme un fichier d’index et que le fichier PHP a été traité par le serveur applicatif PHP.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Si ce n’est pas le cas, reprenez ce manuel depuis le début pour voir ou vous avez décroché.</p> <h3 class="western" lang="fr-FR">Utile</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Ce serveur PHP ne tourne pas en continu, un exécutable est appelé par Apache si nécessaire, donc pas de nécessité de démarrer et d’éteindre le serveur PHP.  </p> <h2 class="western" lang="fr-FR">4.MySQL 5.0.45 [le serveur de bases de données]  </h2> <h3 class="western" lang="fr-FR">Installation  </h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Installer MySQL 5.0.45 (si possible à la racine pour éviter des espaces dans les adresses) (dézipper puis lancer l’exécutable).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Suivre les indications pour la configuration, mais mettre un <b>mot de passe</b> pour l’utilisateur <b>root</b>.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redéfinir la variable d’environnement <b>PATH</b>, pour qu’elle intègre les exécutables.  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Décompressez PhpMyAdmin dans un dossier PhpMyAdmin à la racine du serveur web (Apache/htdocs/). Copiez le fichier <i>config.sample.inc.php</i> et renommez le <i>config.inc.php</i>. Ouvrez ce fichier et ajoutez un mot quelconque à la ligne suivante :</p> <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB">$cfg[‘blowfish_secret’] = ‘<b>secret’</b>; /* YOU MUST FILL IN THIS FOR COOKIE AUTH!*/</span></span></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="en-GB"><br /></p> <h3 class="western" lang="fr-FR">Configuration</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le principal fichier de configuration de MySQL est <b>my.ini </b> </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Un fichier de configuration est créé par l’installation, mais on peut aussi en créer un à partir d’un fichier type fourni par MySQL (my-medium.ini) en le modifiant ensuite.  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> On va configurer les bases de données grâce à l’interface graphique en allant sur <b>http://localhost/phpmyadmin/</b>, loguez-vous.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour ajouter un utilisateur, cliquez sur privilèges, puis laissez-vous guider.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> S’il en existe supprimer toute base de test existante ainsi que tout utilisateur de test.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Evitez les utilisateurs sans mot de passe.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Restreignez l’accès au compte root au serveur (pas d’accès distant)</p> <h3 class="western" lang="fr-FR">Utile</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour démarrer le service MySQL, utilisez la commande suivante :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>NET START MySQL</b></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour l’éteindre :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>NET STOP MySQL</b></span></span></span></p> <h2 class="western" lang="fr-FR">5.Mise en place du site</h2> <h3 class="western" lang="fr-FR">Installation</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Décompressez le contenu de PhpMyVisites2_2.zip dans un dossier PhpMyVisites à la racine du serveur web (Apache/htdocs/).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR">Installez votre site à la racine du serveur web (Apache/htdocs/).</p> <h3 class="western" lang="fr-FR">Configuration</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Tout se passe dans PhpMyVisites, aller sur <span style="color:#0000ff;"><u><a href="http://localhost/phpmyvisites/">http://localhost/phpmyvisites/</a></u></span> pour le configurer. Il vous faudra créer une base de données <b>phpmv</b> ainsi qu’un utilisateur <b>phpmv</b> (vous pouvez choisir le mot de passe) tout cela grâce à PhpMyAdmin installé précédemment.  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> PhpMyVisites et le site doivent être sur le même serveur (sinon, il faut modifier les liens des logiciels vers PhpMyVisites). Il faudra ajouter la portion de code donnée par PhpMyVisites dans toutes les pages html comme indiqué par PhpMyVisites</p><h2 class="western" lang="fr-FR">6.Sun Application Server Platform Edition 9.0.0.1 [le serveur applicatif]</h2> <h3 class="western" lang="fr-FR">Installation</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour installer <b>JAP</b> (Java Application Platform), lancer l’exécutable sjsas_pe-9_0_01-p01-windows.exe récupéré depuis le site de sun.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Installez-le à la racine pour éviter les problèmes d’espace dans les adresses.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le serveur doit écouter sur les ports <b>8080</b> et <b>8181</b> (ou 80 et 81 s’il est en stand-alone)</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pensez à accepter la mise en Service pour que le serveur démarre automatiquement.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Redéfinir la variable d’environnement <b>PATH</b>, pour qu’elle intègre les exécutables (surtout asadmin), même si l’installation vous a dit qu’elle l’avait fait.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Copier dans JAP/lib la librairie java d’accès à la base MySQL : <b>mysql-connector-java-5.0.6-bin.jar</b>, <b>itext-2.0.4.jar </b>(qui gère la création des PDF), ainsi que <b>jdom.jar</b></p> <h3 class="western" lang="fr-FR">Configuration</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> La configuration se fait grâce à l’écran d’administration intranet (accès à <span style="color:#0000ff;"><u><a href="http://localhost:4848/">http://localhost:4848/</a></u></span>).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Un domaine a automatiquement été créé (il s’appelle généralement domain1), il est dans JAP/domains/domain1/ un dossier config permet de configurer à la main le serveur, mais on ne l’utilisera pas.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <b>Asadmin</b> est l’utilitaire en ligne de commande qui permet de gérer le serveur.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"><br /></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour récupérer les erreurs générées par le serveur applicatif, loguez-vous dans l’administration web et cliquez sur ‘View log files’ ou ‘Search Log Files’. Vous n’avez, à priori, aucune modification à faire à la configuration par défaut (à part celle demandée par ce manuel).</p> <h3 class="western" lang="fr-FR">Utile</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour démarrer le serveur, utilisez la ligne de commande suivante :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>asadmin start-domain</b></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour l’éteindre :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>asadmin stop-domain</b></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour connaitre l’état des domaines :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b><span lang="fr-FR">asadmin list-domains</span></b></span></span></span></p> <h3 class="western" lang="fr-FR">Déploiement</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Dernière étape, la plus simple, le déploiement des applications sur le serveur applicatif :  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Démarrer le serveur applicatif, connectez vous sur l’interface d’administration intranet.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Cliquez sur Application/Web-Application, puis sur deploy… Choisissez l’archive war (web archive) correspondante à l’application à déployer, puis sur next.</p> <h2 class="western" lang="fr-FR">7.Mod_jk (Connecteur Apache -&gt; Serveur applicatif)</h2> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Mod_jk permet de router les requêtes du serveur applicatif reçues par Apache vers le serveur applicatif : Le serveur applicatif écoute sur le port 8080 et pourtant on se connecte sur le port 80 (port par défaut d’internet). Apache écoute sur ce port 80. On doit lui préciser comment et quelle requêtes renvoyer.   </p> <h3 class="western" lang="fr-FR">Installation</h3> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <i>Une autre source : </i><a title="http://weblogs.java.net/blog/jfarcand/archive/2006/03/running_glassfi_1.html" href="http://weblogs.java.net/blog/jfarcand/archive/2006/03/running_glassfi_1.html" id="q_ya">http://weblogs.java.net/blog/jfarcand/archive/2006/03/running_glassfi_1.html</a> </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Eteignez les serveurs Apache et JAP.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Copiez mod_jk.so disponible sur le site d’Apache dans le répertoire modules d’Apache (Apache/modules).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"><br /></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Demandez à Apache de charger le module, ajoutez les lignes suivantes à <b>httpd.conf</b> (<b>en pensant à adapter le chemin d'accès</b>) :</p>             <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"># Chargement du module JK (adaptez le chemin d’acces)<br />LoadModule jk_module C:/Apache/modules/mod_jk.so <br />JkWorkersFile C:/Apache/conf/worker.properties<br /># L’adresse des logs (avec ceux de Apache par exemple)<br />JkLogFile C:/Apache/logs/mod_jk.log<br /># Le niveau de log [debug/error/info]<br /># Passez le temporairement en debug, si nécessaire<br />JkLogLevel info<br /># Le format de log<br />JkLogStampFormat "[%a %b %d %H:%M:%S %Y] "<br /># JkOptions (ne pas modifier)<br />JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories# JkRequestLogFormat (ne pas modifier)<br />JkRequestLogFormat "%w %V %T"</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> On va ensuite prévenir le serveur applicatif de l’utilisation de mod_jk.  </p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> On va commencer par lui donner les outils nécessaires à la communication. Copiez les 3 archives jar (commons-logging.jar, commons-modeler.jar, tomcat-ajp.jar)  vers le dossier lib de JAP.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> On va ensuite lui demander d’écoute ce connecteur, pour cela appeler la commande suivante :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>Asadmin start-domain</b></span></span></span> (pour démarrer le serveur)</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>asadmin create-jvm-options -Dcom.sun.enterprise.web.connector.enableJK=8080</b></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><span lang="fr-FR"><span style="font-size:100%;"><span style="font-family:Times New Roman, serif;">Faites bien attention à ne pas faire de fautes de frappe, c’est bien enterprise et non entreprise !</span></span></span></span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Cette option va créer une option dans la machine virtuelle java qui exécute le serveur, elle va forcer le serveur applicatif à écouter le connecteur.</p>  <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le serveur écoutait déjà sur le port 8080, ce qui pose un problème car deux processus ne peuvent pas écouter sur le même port (l’accepteur http et l’accepteur du connecteur). Nous devons donc en supprimez un (l’accepteur HTTP, ce qui évitera les demandes directes sur le serveur applicatif).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Pour supprimer cet écouteur, démarrer le serveur, connectez vous sur l’interface web d’administration, loguez-vous, cliquez sur configuration puis http-service, puis http listeners.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Sélectionnez les http-listener-1 et http-listener-2 sur les ports 8080 et 8181 (ssl) et supprimez-les.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Le serveur applicatif peut enfin écouter sans problème.</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Eteignez le serveur applicatif. (<span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b>asadmin stop-domain</b></span></span></span>)</p>  <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Dernière étape de cette configuration, vous devez indiquer à Apache quelles requêtes renvoyer, à qui et comment. Pour cela, nous allons créer un fichier configurant des worker (les objets qui renvoient les requêtes). Créer un fichier <b>worker.properties</b> dans le dossier Apache/conf/ (si le serveur applicatif est sur un serveur distant, modifiez la propriété host) :</p>      <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"># Creation d’un worker pour le serveur applicatif<br /><span lang="en-GB">worker.list=</span>workerJava<br /># Donnons quelques propriété pour info<br />worker.workerJava.type=ajp13<br /><span lang="en-GB">worker.workerJava.host=localhost<br />worker.workerJava.port=8080</span></span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Nous avons définit un worker qui connectera le serveur web avec le serveur applicatif (on a donc le comment et le où).</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Spécifions maintenant les règles de routage :</p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Dans <b>httpd.conf</b>, ajoutez les lignes suivantes :</p>   <p style="border: 1px solid rgb(0, 0, 0); padding: 0.01in 0.06in; margin-left: 0.39in; margin-bottom: 0.17in; line-height: 150%;" align="justify" lang=""> <span style="font-family:Courier New, monospace;"><span style="font-size:85%;"># On envoie les requêtes au serveur applicatif :<br /># Pour test<br />JkMount /test/* workerJava</span></span></p> <p style="margin-left: 0.39in; margin-bottom: 0in;" align="justify" lang="fr-FR"> Normalement ici, tout devrait être fonctionnel. Pour le vérifier, démarrer le serveur (<span style="font-family:Courier New, monospace;"><span style="font-size:85%;"><span lang="en-GB"><b><span lang="fr-FR">asadmin start-domain</span></b></span></span></span>).</p> <div type="FOOTER"><br /></div>